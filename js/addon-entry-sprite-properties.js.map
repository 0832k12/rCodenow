{"version":3,"file":"js/addon-entry-sprite-properties.js","sources":["webpack://GUI/./src/addons/addons/sprite-properties/userstyle.css","webpack://GUI/./src/addons/addons/sprite-properties/collapse.svg","webpack://GUI/./src/addons/addons/sprite-properties/info.svg","webpack://GUI/./src/addons/addons/sprite-properties/_runtime_entry.js","webpack://GUI/./src/addons/addons/sprite-properties/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class^=\\\"sprite-info_sprite-info_\\\"] {\\n  height: 0;\\n  padding: 0 0.75rem;\\n  overflow: hidden;\\n  transition-property: height, padding, transform;\\n  transition-duration: var(--spriteProperties-transitionDuration);\\n}\\n\\n.sa-hide-sprite-properties [class^=\\\"sprite-info_sprite-info_\\\"] {\\n  border: none;\\n}\\n\\n[class^=\\\"sprite-selector_scroll-wrapper_\\\"] {\\n  height: 100%;\\n  transition-property: height;\\n  transition-duration: var(--spriteProperties-transitionDuration);\\n}\\n\\n.sa-show-sprite-properties [class^=\\\"sprite-info_sprite-info_\\\"] {\\n  /* The height needs to be known for the animation to work.\\n     6.5rem + 5px is the exact height of sprite info when\\n     this addon is enabled:\\n       0.75rem (top padding)\\n     + 2rem + 2px (.icon-wrappers in the first row)\\n     + 0.5rem (margin between rows)\\n     + 2rem + 2px (.icon-wrappers in the second row)\\n     + 1.25rem (close button)\\n     + 1px (bottom border) */\\n  height: calc(6.5rem + 5px);\\n  padding: 0.75rem;\\n  padding-bottom: 0;\\n}\\n.sa-sprite-properties-wide-locale.sa-show-sprite-properties [class^=\\\"sprite-info_sprite-info_\\\"] {\\n  /* In wide languages, add in addition to the previous:\\n     + 2 * 0.625rem * 1.2 (each row's text label now uses vertical space)\\n     + 2 * 0.25rem (each row has extra padding) */\\n  height: calc(6.5rem + 5px + 2rem);\\n}\\n[class^=\\\"label_input-group-column_\\\"] {\\n  /* Default line-height: normal is inconsistent across browsers, but above style needs constant line-height. */\\n  line-height: 1.2;\\n}\\n\\n/* see heights in above selectors */\\n.sa-show-sprite-properties [class^=\\\"sprite-selector_scroll-wrapper_\\\"] {\\n  height: calc(100% - 6.5rem - 5px);\\n}\\n.sa-sprite-properties-wide-locale.sa-show-sprite-properties [class^=\\\"sprite-selector_scroll-wrapper_\\\"] {\\n  height: calc(100% - 6.5rem - 5px - 2rem);\\n}\\n\\n.sa-sprite-properties-info-btn {\\n  /* !important to override displayNoneWhileDisabled's inline styles */\\n  display: flex !important;\\n  position: absolute;\\n  justify-content: center;\\n  align-items: center;\\n  width: 1rem;\\n  height: 1rem;\\n  top: -2px;\\n  left: -2px;\\n  border: none;\\n  border-radius: 100%;\\n  background-color: var(--editorDarkMode-primary, hsla(0, 100%, 65%, 1));\\n}\\n[dir=\\\"rtl\\\"] .sa-sprite-properties-info-btn {\\n  left: auto;\\n  right: -2px;\\n}\\n.sa-show-sprite-properties .sa-sprite-properties-info-btn {\\n  display: none !important;\\n}\\n\\n.sa-sprite-properties-info-btn img {\\n  width: calc(1rem - 6px);\\n  height: calc(1rem - 6px);\\n  filter: var(--editorDarkMode-primary-filter);\\n}\\n\\n.sa-sprite-properties-close-btn {\\n  width: 100%;\\n  height: 1.25rem;\\n  padding: 0;\\n  padding-top: 0.5rem;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  border: none;\\n  background-color: transparent;\\n  user-select: none;\\n}\\n\\n.sa-sprite-properties-close-btn img {\\n  filter: var(--editorDarkMode-accent-filter);\\n  transition: opacity 0.25s ease-out;\\n}\\n\\n.sa-sprite-properties-close-btn:hover img {\\n  opacity: 0.75;\\n}\\n\\n/* Prevent double clicking from highlighting the \\\"Choose a sprite\\\" button */\\n[class*=\\\"action-menu_main-button_\\\"] {\\n  user-select: none;\\n}\\n\", \"\"]);\n\n// exports\n","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIuNyIgaGVpZ2h0PSI4Ljc5IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik02LjM2IDFhMS40MyAxLjQzIDAgMCAwLTEgLjQyTDEuNDIgNS4zNGExLjQ0IDEuNDQgMCAwIDAgMCAyYy41Ni41NiA5LjMxLjU2IDkuODcgMGExLjQ0IDEuNDQgMCAwIDAgMC0yTDcuMzcgMS40MkExLjQzIDEuNDMgMCAwIDAgNi4zNiAxeiIgZmlsbD0iIzU3NWU3NSIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAwLjU3IDAuNTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI2ZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNLjIzMi4yMzJ2LjAzNmguMDM2Vi41SC4yMTR2LjAzNWguMTQzVi41SC4zMDRWLjIzM3oiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIuMDcxIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjxjaXJjbGUgY3g9Ii4yODUiIGN5PSIuMDcxIiByPSIuMDcxIiBzdHlsZT0icGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycyIvPjwvZz48L3N2Zz4=\"","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userstyle.css\";\nimport _asset from \"!url-loader!./collapse.svg\";\nimport _asset2 from \"!url-loader!./info.svg\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userstyle.css\": _css,\n  \"collapse.svg\": _asset,\n  \"info.svg\": _asset2,\n};\n","export default async function ({ addon, console, msg }) {\n  const SHOW_PROPS_CLASS = \"sa-show-sprite-properties\";\n  const HIDE_PROPS_CLASS = \"sa-hide-sprite-properties\";\n  const PROPS_INFO_BTN_CLASS = \"sa-sprite-properties-info-btn\";\n  const PROPS_CLOSE_BTN_CLASS = \"sa-sprite-properties-close-btn\";\n\n  /** @type {HTMLElement} */\n  let propertiesPanel;\n\n  // A mutation observer is the only reliable way to detect when a different sprite has\n  // been selected or when the folder that contains the focused sprite has been opened.\n  const observer = new MutationObserver(() => {\n    injectInfoButton();\n  });\n\n  // Toggle the properties panel when double clicking in the sprite grid\n  document.addEventListener(\"click\", (e) => {\n    if (e.detail === 2 && e.target.closest('[class^=\"sprite-selector_scroll-wrapper_\"]')) {\n      togglePropertiesPanel();\n    }\n  });\n\n  function setPropertiesPanelVisible(visible) {\n    document.body.classList.toggle(SHOW_PROPS_CLASS, visible);\n    document.body.classList.toggle(HIDE_PROPS_CLASS, !visible);\n  }\n\n  function togglePropertiesPanel() {\n    const isCurrentlyOpen = document.body.classList.contains(SHOW_PROPS_CLASS);\n    setPropertiesPanelVisible(!isCurrentlyOpen);\n  }\n\n  function autoHidePanel() {\n    if (addon.settings.get(\"autoCollapse\")) {\n      setPropertiesPanelVisible(false);\n    }\n  }\n  // Close properties panel when mouse leaves the entire sprite panel\n  document.body.addEventListener(\n    \"mouseleave\",\n    (e) => {\n      if (e.target.matches('[class*=\"sprite-selector_sprite-selector_2KgCX\"]')) {\n        autoHidePanel();\n      }\n    },\n    {\n      capture: true,\n    }\n  );\n  addon.settings.addEventListener(\"change\", autoHidePanel);\n\n  function applySettings() {\n    const visibleByDefault = !addon.settings.get(\"autoCollapse\") && !addon.settings.get(\"hideByDefault\");\n    setPropertiesPanelVisible(visibleByDefault);\n  }\n  addon.self.addEventListener(\"reenabled\", applySettings);\n  applySettings();\n\n  addon.self.addEventListener(\"disabled\", () => {\n    setPropertiesPanelVisible(true);\n  });\n\n  function createButton(className, iconPath, tooltip) {\n    const buttonIcon = document.createElement(\"img\");\n    buttonIcon.setAttribute(\"src\", addon.self.getResource(iconPath)) /* rewritten by pull.js */;\n    buttonIcon.draggable = false;\n    const button = document.createElement(\"button\");\n    button.classList.add(className);\n    button.title = tooltip;\n    button.addEventListener(\"click\", () => togglePropertiesPanel());\n    button.appendChild(buttonIcon);\n    addon.tab.displayNoneWhileDisabled(button, { display: \"flex\" });\n    return button;\n  }\n\n  /** @type {HTMLElement} */\n  let infoButton;\n  /** @type {HTMLElement} */\n  let closeButton;\n\n  function injectInfoButton() {\n    if (!infoButton) {\n      infoButton = createButton(PROPS_INFO_BTN_CLASS, \"/info.svg\", msg(\"open-properties-panel-tooltip\"));\n    }\n    const selectedSprite = propertiesPanel.parentNode.querySelector('[class*=\"sprite-selector-item_is-selected\"]');\n    if (infoButton.parentNode !== selectedSprite) {\n      if (selectedSprite) {\n        selectedSprite.appendChild(infoButton);\n      } else {\n        infoButton.remove();\n      }\n    }\n  }\n\n  function injectCloseButton() {\n    if (!closeButton) {\n      closeButton = createButton(PROPS_CLOSE_BTN_CLASS, \"/collapse.svg\", msg(\"close-properties-panel-tooltip\"));\n    }\n    propertiesPanel.appendChild(closeButton);\n  }\n\n  function updateWideLocaleMode() {\n    // Certain \"wide\" languages such as Japanese use a different layout for the sprite info panel\n    // Easiest way to detect this is with this selector that only exists when the sprite info panel\n    // is using the layout with text above the input.\n    // Note that when the stage is in small mode, \"wide\" languages use the same info panel as other\n    // languages.\n    // List of languages is here:\n    // https://github.com/LLK/scratch-gui/blob/e15b2dfa3a2e58e80fae8d1586c7f56aa0cc0ede/src/lib/locale-utils.js#L6-L18\n    const isWideLocale = !!propertiesPanel.querySelector(\"[class^=label_input-group-column_]\");\n    document.body.classList.toggle(\"sa-sprite-properties-wide-locale\", isWideLocale);\n  }\n\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      if (\n        e.target.closest(\"[class*='stage-header_stage-button-first']\") ||\n        e.target.closest(\"[class*='stage-header_stage-button-last']\")\n      ) {\n        setTimeout(updateWideLocaleMode);\n      }\n    },\n    { capture: true }\n  );\n\n  while (true) {\n    propertiesPanel = await addon.tab.waitForElement('[class^=\"sprite-info_sprite-info_\"]', {\n      markAsSeen: true,\n      reduxEvents: [\"scratch-gui/mode/SET_PLAYER\", \"fontsLoaded/SET_FONTS_LOADED\", \"scratch-gui/locales/SELECT_LOCALE\"],\n      reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\n    });\n\n    const spriteSelector = propertiesPanel.parentNode;\n    const itemsWrapper = spriteSelector.querySelector('[class*=\"sprite-selector_items-wrapper_\"]');\n    observer.observe(itemsWrapper, {\n      childList: true,\n      subtree: true,\n    });\n\n    updateWideLocaleMode();\n    injectInfoButton();\n    injectCloseButton();\n  }\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAIA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}